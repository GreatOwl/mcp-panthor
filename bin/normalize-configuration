#!/usr/bin/env bash

# configure
set -e
set -u

# declare variables
p_DIR=$( cd "$( dirname "$0" )" && pwd )
p_HAL_ENVIRONMENT="${HAL_ENVIRONMENT:=}"

if [ -z  "$p_HAL_ENVIRONMENT" ] ; then
    echo "HAL 9000 environment not found. Using development configuration."
    p_HAL_ENVIRONMENT="dev"
fi

p_NORMALIZED_ENV=$(echo "$p_HAL_ENVIRONMENT" | tr "[:upper:]" "[:lower:]")
p_TARGET_CONFIG="config.env.yml"
p_CONFIG="$p_NORMALIZED_ENV.yml"

# script
echo "Current environment: $p_HAL_ENVIRONMENT"
echo "Normalized environment: $p_NORMALIZED_ENV"

p_EXISTS=$(test -e $p_DIR/../configuration/environment/$p_CONFIG && echo 1 || echo 0)
if [[ $p_EXISTS -eq "1" ]]; then
    echo "Configuration found: $p_CONFIG"
    echo "Overwriting $p_TARGET_CONFIG"
    cat "$p_DIR/../configuration/environment/$p_CONFIG" > "$p_DIR/../configuration/config.env.yml"
else
    echo "Configuration not found: $p_CONFIG"
fi
